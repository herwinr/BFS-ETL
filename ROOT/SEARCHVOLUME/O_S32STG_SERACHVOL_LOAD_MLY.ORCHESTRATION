{"job":{"components":{"304140":{"id":304140,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-768,"y":-32,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[316604],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"315822":{"id":315822,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-368,"y":-32,"width":32,"height":32,"inputConnectorIDs":[331697],"outputSuccessConnectorIDs":[338568],"outputFailureConnectorIDs":[326746],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"STAGE_LOAD"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":" COPY INTO \"${DB}\".\"${STAGE_SCHEMA}\".\"ST_BFSI_KW_SV\"(\"as_on_date\",\"keyword\",\"locale\",\"search_volume\",\"adj_srch_volume\")\nFROM\n(\nSELECT $1,$2,$3,$4,$5\nFROM '@DM_INTERNAL.RESEARCH.MATILLION_STAGE_/ALPS/BFSI/DEV/SEARCHVOLUME/20200722/${ADJ_SHARE}'\n)\nFILE_FORMAT = DM_INTERNAL.RESEARCH.CSV PURGE=FALSE ON_ERROR = CONTINUE FORCE=FALSE;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"316600":{"id":316600,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-624,"y":-32,"width":32,"height":32,"inputConnectorIDs":[316604],"outputSuccessConnectorIDs":[331691],"outputFailureConnectorIDs":[326749],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TRN_STAGE_TBL"}}}},"visible":true},"3":{"slot":3,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DB}"}}}},"visible":true},"4":{"slot":4,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${STAGE_SCHEMA}"}}}},"visible":true},"5":{"slot":5,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ST_BFSI_KW_SV"}}}},"visible":true},"6":{"slot":6,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DW_PRODUCTS}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"317171":{"id":317171,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-30576616,"x":-112,"y":-32,"width":32,"height":32,"inputConnectorIDs":[340434],"outputSuccessConnectorIDs":[331793],"outputFailureConnectorIDs":[326784],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ARCHIVE_MOVE"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"aws s3 mv '${S3_PATH}'SEARCHVOLUME/'${ADJ_SHARE}' '${S3_PATH}'SEARCHVOLUME/ARCHIVE/`date \"+%Y%m%d\"`/'${ADJ_SHARE}'"}}}},"visible":true},"3":{"slot":3,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"326735":{"id":326735,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-240,"y":-176,"width":32,"height":32,"inputConnectorIDs":[326746,326749,326784,333081,333134,338617],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[331735],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ERROR HANDLING"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"326792":{"id":326792,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":320,"y":-176,"width":32,"height":32,"inputConnectorIDs":[331731],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"326805":{"id":326805,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":320,"y":-32,"width":32,"height":32,"inputConnectorIDs":[344856],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"331683":{"id":331683,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-496,"y":-32,"width":32,"height":32,"inputConnectorIDs":[331691],"outputSuccessConnectorIDs":[331697],"outputFailureConnectorIDs":[333081],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AUDIT_TABLE_UPDATE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into \"${DB}\".\"${STAGE_SCHEMA}\".st_audit \n(status,start_time,job_name,s3_path,file_name)\nvalues('In progress',current_timestamp,'SEARCHVOLUME LOAD','${S3_PATH}SEARCHVOLUME','${ADJ_SHARE}')"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"331712":{"id":331712,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":128,"y":-176,"width":32,"height":32,"inputConnectorIDs":[331735],"outputSuccessConnectorIDs":[331731],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AUDIT_TABLE_FAIL_STATUS"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"update \"${DB}\".\"${STAGE_SCHEMA}\".st_audit \nset status = 'Failed'\n,end_time = current_timestamp \n,file_count=(select cnt from (\nSELECT COUNT(\"created_date\")cnt from \"${DB}\".\"${DWH_SCHEMA}\".\"LKP_BFSI_KW_SV\" where \"filename\"='${ADJ_SHARE}'\n))\n,duplicate_count=(select case when sum(cnt) is null then 0 else sum(cnt) end as cnt from (\nselect  \"keyword\" ,count(\"keyword\")cnt FROM \"${DB}\".\"${DWH_SCHEMA}\".\"LKP_BFSI_KW_SV\"\n group by \"as_on_date\",\"keyword\",\"locale\",\"search_volume\",\"adj_srch_volume\"\n  HAVING COUNT(\"keyword\") >1\n\n))\nwhere audit_id = (select max(audit_id) from \"${DB}\".\"${STAGE_SCHEMA}\".st_audit where job_name='SEARCHVOLUME LOAD')"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"331784":{"id":331784,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":144,"y":-32,"width":32,"height":32,"inputConnectorIDs":[331793],"outputSuccessConnectorIDs":[344856],"outputFailureConnectorIDs":[333134],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AUDIT_TABLE_SUCCESS_STATUS"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"update \"${DB}\".\"${STAGE_SCHEMA}\".st_audit \nset status = 'Completed'\n,end_time = current_timestamp \n,file_count=(select cnt from (\nSELECT COUNT(\"created_date\")cnt from \"${DB}\".\"${DWH_SCHEMA}\".\"LKP_BFSI_KW_SV\" where \"filename\"='${ADJ_SHARE}'\n))\n,duplicate_count=(select case when sum(cnt) is null then 0 else sum(cnt) end as cnt from (\nselect  \"keyword\" ,count(\"keyword\")cnt FROM \"${DB}\".\"${DWH_SCHEMA}\".\"LKP_BFSI_KW_SV\"\n group by \"as_on_date\",\"keyword\",\"locale\",\"search_volume\",\"adj_srch_volume\"\n  HAVING COUNT(\"keyword\") >1\n\n))\nwhere audit_id = (select max(audit_id) from \"${DB}\".\"${STAGE_SCHEMA}\".st_audit where job_name='SEARCHVOLUME LOAD')"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"338569":{"id":338569,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-240,"y":-32,"width":32,"height":32,"inputConnectorIDs":[338568],"outputSuccessConnectorIDs":[340434],"outputFailureConnectorIDs":[338617],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SEARCH_VOLUME_DWH_LOAD"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TR_STG2LKP_SERACHVOL_LOAD_MLY"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"331691":{"id":331691,"sourceID":316600,"targetID":331683},"331697":{"id":331697,"sourceID":331683,"targetID":315822},"331731":{"id":331731,"sourceID":331712,"targetID":326792},"331793":{"id":331793,"sourceID":317171,"targetID":331784},"338568":{"id":338568,"sourceID":315822,"targetID":338569},"340434":{"id":340434,"sourceID":338569,"targetID":317171},"344856":{"id":344856,"sourceID":331784,"targetID":326805}},"failureConnectors":{"326746":{"id":326746,"sourceID":315822,"targetID":326735},"326749":{"id":326749,"sourceID":316600,"targetID":326735},"326784":{"id":326784,"sourceID":317171,"targetID":326735},"333081":{"id":333081,"sourceID":331683,"targetID":326735},"333134":{"id":333134,"sourceID":331784,"targetID":326735},"338617":{"id":338617,"sourceID":338569,"targetID":326735}},"unconditionalConnectors":{"316604":{"id":316604,"sourceID":304140,"targetID":316600},"331735":{"id":331735,"sourceID":326735,"targetID":331712}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":true,"undoCommand":"Disable Components","undoCreated":1599105610846,"canRedo":false,"redoCommand":"","redoCreated":1596178404918,"notes":{},"variables":{"SEARCH_VOLUME":{"definition":{"name":"SEARCH_VOLUME","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"s3://iquanti-matillion/ALPS/BFSI/DEV/SEARCHVOLUME"}},"grids":{}},"info":{"name":"O_S32STG_SERACHVOL_LOAD_MLY","description":"","type":"ORCHESTRATION"}}