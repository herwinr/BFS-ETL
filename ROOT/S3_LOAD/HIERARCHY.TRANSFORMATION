{"job":{"components":{"434523":{"id":434523,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":384,"y":128,"width":32,"height":32,"inputConnectorIDs":[434520,434534],"outputConnectorIDs":[434557],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"JOIN"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"THEME"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INTERMEDIATE"},"2":{"slot":2,"type":"STRING","value":"SUB"},"3":{"slot":3,"type":"STRING","value":"Inner"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"MAIN\".\"UNIVERSE\" = \"SUB\".\"UNIVERSE\"\nAND\n\"MAIN\".\"LOCALE\" = \"SUB\".\"LOCALE\""},"2":{"slot":2,"type":"STRING","value":"MAIN_Inner_SUB"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.KEYWORD"},"2":{"slot":2,"type":"STRING","value":"KEYWORD"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.PARENT_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"PARENT_CATEGORY"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.PARENT_CATEGORY_TAG"},"2":{"slot":2,"type":"STRING","value":"PARENT_CATEGORY_TAG"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.CATEGORY"},"2":{"slot":2,"type":"STRING","value":"CATEGORY"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.CATEGORY_TAG"},"2":{"slot":2,"type":"STRING","value":"CATEGORY_TAG"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.SUBCATEGORY"},"2":{"slot":2,"type":"STRING","value":"SUBCATEGORY"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.SUBCATEGORY_TAG"},"2":{"slot":2,"type":"STRING","value":"SUBCATEGORY_TAG"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.THEME"},"2":{"slot":2,"type":"STRING","value":"THEME"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.THEME_TAG"},"2":{"slot":2,"type":"STRING","value":"THEME_TAG"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.UNIVERSE"},"2":{"slot":2,"type":"STRING","value":"MAIN_UNIVERSE"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.LOCALE"},"2":{"slot":2,"type":"STRING","value":"MAIN_LOCALE"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.CREATED_DATE"},"2":{"slot":2,"type":"STRING","value":"CREATED_DATE"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.MODIFIED_DATE"},"2":{"slot":2,"type":"STRING","value":"MODIFIED_DATE"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.KW_KEY"},"2":{"slot":2,"type":"STRING","value":"KW_KEY"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"MAIN.KW_PRODUCT_LOCALE_KEY"},"2":{"slot":2,"type":"STRING","value":"KW_PRODUCT_LOCALE_KEY"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"SUB.UNIVERSE"},"2":{"slot":2,"type":"STRING","value":"SUB_UNIVERSE"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"SUB.LOCALE"},"2":{"slot":2,"type":"STRING","value":"SUB_LOCALE"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"434525":{"id":434525,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":218,"y":176,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[434520],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INTERMEDIATE"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DIM_BFSI_UNI_HRCHY_INTERMEDIATE"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UNIVERSE"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"LOCALE"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DWH_SCHEMA}"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DB}"}}}},"visible":true},"7":{"slot":7,"name":"Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"434527":{"id":434527,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":228,"y":93,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[434534],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"THEME"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DIM_BFSI_KW_UNI_HRCHY_THEME"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"KEYWORD"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"PARENT_CATEGORY"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"PARENT_CATEGORY_TAG"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"CATEGORY"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"CATEGORY_TAG"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"SUBCATEGORY"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"SUBCATEGORY_TAG"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"THEME"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"THEME_TAG"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"UNIVERSE"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"LOCALE"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"CREATED_DATE"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"MODIFIED_DATE"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"KW_KEY"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"KW_PRODUCT_LOCALE_KEY"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DWH_SCHEMA}"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DB}"}}}},"visible":true},"7":{"slot":7,"name":"Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"434556":{"id":434556,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":576,"y":128,"width":32,"height":32,"inputConnectorIDs":[434557],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DELETE FROM $T{JOIN}"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"476708":{"id":476708,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":2,"y":186,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL 1"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"WITH TOPHNDRD AS\n\t(\n\t\tSELECT\n\t\t\tkeyword,\nProduct,\nLocale,\nSearch_Engine,\ndomain,\nsub_domain,\nDomain_Type,\nDeviceType,\nSearch_Volume,\nTraffic,\nMonth_yr,\nYYYYMMDD,\nparent_category,\ncategory,\nsubcategory,\ntheme,\npack_type,\nMARKETING_FUNNEL,\n KW_TYPE_LIST_FLAG ,\n                KW_TYPE_QUESTION_FLAG ,\n                KW_TYPE_LOCATION_FLAG ,\n                KW_TYPE_COUNTRY_FLAG ,\n                KW_TYPE_STATE_FLAG ,\n                KW_TYPE_CITY_FLAG ,\n                KW_TYPE_ENTITY_FLAG ,\n                HEAD_TAIL ,\n\t\t\t\t\n            \"RANK1-5\" as \"RANK1-5\",\n            case when \"RANK1-5\" = 1 then 0 \n            else \"RANK6-10\" end as \"RANK6-10\",\n            case when \"RANK1-5\"= 1 then 0\n                 when \"RANK6-10\" = 1 then 0\n            else \"PAGE2\" end as \"PAGE2\",\n\t\t\tBRAND_NONBRAND,\n\t\t\tROW_NUMBER() over (PARTITION BY Product,locale,Month_yr,Domain_Type order by traffic DESC) AS RowNo\n\t\tFROM\n\t\t(\n\t\t\tSELECT\n\t\t\t\tagg.keyword as keyword,\n                theme.universe AS Product,\n                agg.locale AS Locale,\n                agg.search_engine AS Search_Engine,\n                domain.domain,\n                domain.sub_domain,\n                CASE\n                    WHEN domain.domain_type IS NULL THEN 'Other'\n                    ELSE domain.domain_type\n                END AS Domain_Type,\n                agg.DeviceType,\n                max(agg.\"RANK1-5\") as \"RANK1-5\",\n                max(agg.\"RANK6-10\") as \"RANK6-10\",\n                max(agg.\"PAGE2\") as \"PAGE2\",\n                SUM(DISTINCT agg.search_volume) AS Search_Volume,\n                SUM(DISTINCT agg.traffic) AS Traffic,\n                agg.month_yr AS Month_yr,\n                agg.YYYYMMDD,\n                theme.parent_category,\n                theme.category,\n                theme.subcategory,\n                theme.theme,\n                device.pack_type,\n                flag.MARKETING_STAGE as  MARKETING_FUNNEL,\n                flag.KW_TYPE_LIST_FLAG ,\n                flag.KW_TYPE_QUESTION_FLAG ,\n                flag.KW_TYPE_LOCATION_FLAG ,\n                flag.KW_TYPE_COUNTRY_FLAG ,\n                flag.KW_TYPE_STATE_FLAG ,\n                flag.KW_TYPE_CITY_FLAG ,\n                flag.KW_TYPE_ENTITY_FLAG ,\n                flag.HEAD_TAIL ,\n\t\t\t\tcompany.BRAND_NONBRAND\n\t\t\tFROM \"BFSI_CI\".\"UAT\".\"AGG_BFSI_SOS_MONTHLY_TRAFFIC\" AS agg\n                  INNER JOIN \"BFSI_CI\".\"UAT\".\"DIM_BFSI_THEME_KW_LEVEL\" AS theme ON (agg.keyword=theme.keyword AND agg.locale=theme.locale)\n                  LEFT JOIN \"BFSI_CI\".\"UAT\".\"DIM_BFSI_KE_DOMAIN_SUB_MAP\" AS domain ON (domain.keyword=agg.keyword and domain.domain=agg.domain and domain.locale=agg.locale)\n                  LEFT JOIN \"BFSI_CI\".\"UAT\".\"DIM_BFSI_SERP_PACK_DATA\"  AS device on (device.keyword=agg.keyword and device.DEVICE =agg.DeviceType and device.locale=agg.locale)\n                  LEFT JOIN \"BFSI_CI\".\"UAT\".\"DIM_BFSI_INTENT_STAGE_CFN_KW_LEVEL\"  AS flag\n\t\t\t\t  ON(agg.keyword=flag.keyword)\n                   LEFT JOIN \"BFSI_CI\".\"UAT\".\"DIM_BFSI_COMPANY_KW_LEVEL\" AS company\n\t\t\t\t   on(agg.keyword=company.keyword)\n          \n          \n\t\t\tGROUP BY\n\t\t\tagg.keyword,\n            theme.universe,\n            agg.Locale,\n            agg.Search_Engine,\n            agg.DeviceType,\n            agg.month_yr,\n            agg.YYYYMMDD,\n            domain.Domain_Type,\n            agg.Domain,\n            domain.KW_LOCALE_DOMAIN_KEY,\n            theme.parent_category,\n                theme.category,\n                theme.subcategory,\n                theme.theme,\n            device.KW_LOCALE_DEVICE_KEY,\n            domain.domain,\n            DOMAIN.SUB_DOMAIN,\n            DEVICE.PACK_TYPE,\n            FLAG.MARKETING_STAGE,\n            flag.KW_TYPE_LIST_FLAG ,\n                flag.KW_TYPE_QUESTION_FLAG ,\n                flag.KW_TYPE_LOCATION_FLAG ,\n                flag.KW_TYPE_COUNTRY_FLAG ,\n                flag.KW_TYPE_STATE_FLAG ,\n                flag.KW_TYPE_CITY_FLAG ,\n                flag.KW_TYPE_ENTITY_FLAG ,\n                flag.HEAD_TAIL ,\n\t\t\t\tcompany.BRAND_NONBRAND\n\t\t\t--ORDER BY search_volume desc\n\t\t)\n\t\tWHERE TRAFFIC IS NOT NULL AND   Domain_Type = 'Other'\n\t)\n\tSELECT\n\t\tkeyword,\nProduct,\nLocale,\nSearch_Engine,\ndomain,\nsub_domain,\nDomain_Type,\nDeviceType,\nSearch_Volume,\nTraffic,\nMonth_yr,\nYYYYMMDD,\nparent_category,\ncategory,\nsubcategory,\ntheme,\npack_type,\nMARKETING_FUNNEL,\n KW_TYPE_LIST_FLAG ,\n                KW_TYPE_QUESTION_FLAG ,\n                KW_TYPE_LOCATION_FLAG ,\n                KW_TYPE_COUNTRY_FLAG ,\n                KW_TYPE_STATE_FLAG ,\n                KW_TYPE_CITY_FLAG ,\n                KW_TYPE_ENTITY_FLAG ,\n                HEAD_TAIL ,\n\t\t\t\tBRAND_NONBRAND,\n\t\t\n        \"RANK1-5\" as RANK_1_5,\n        \"RANK6-10\" as RANK_6_10,\n         \"PAGE2\" as PAGE2\n\tFROM TOPHNDRD WHERE RowNo <= 100\n\n\tUNION ALL\n\t\n    SELECT\n\t\tkeyword,\nProduct,\nLocale,\nSearch_Engine,\ndomain,\nsub_domain,\nDomain_Type,\nDeviceType,\nSearch_Volume,\nTraffic,\nMonth_yr,\nYYYYMMDD,\nparent_category,\ncategory,\nsubcategory,\ntheme,\npack_type,\nMARKETING_FUNNEL,\n KW_TYPE_LIST_FLAG ,\n                KW_TYPE_QUESTION_FLAG ,\n                KW_TYPE_LOCATION_FLAG ,\n                KW_TYPE_COUNTRY_FLAG ,\n                KW_TYPE_STATE_FLAG ,\n                KW_TYPE_CITY_FLAG ,\n                KW_TYPE_ENTITY_FLAG ,\n                HEAD_TAIL ,\n\t\t\t\t\n            \"RANK1-5\" as \"RANK1-5\",\n            case when \"RANK1-5\" = 1 then 0 \n            else \"RANK6-10\" end as \"RANK6-10\",\n            case when \"RANK1-5\"= 1 then 0\n                 when \"RANK6-10\" = 1 then 0\n            else \"PAGE2\" end as \"PAGE2\",\n\t\t\tBRAND_NONBRAND\n\tFROM\n\t(\n\t\tSELECT\n\t\t\t\tagg.keyword as keyword,\n                theme.universe AS Product,\n                agg.locale AS Locale,\n                agg.search_engine AS Search_Engine,\n                domain.domain,\n                domain.sub_domain,\n                CASE\n                    WHEN domain.domain_type IS NULL THEN 'Other'\n                    ELSE domain.domain_type\n                END AS Domain_Type,\n                agg.DeviceType,\n                max(agg.\"RANK1-5\") as \"RANK1-5\",\n                max(agg.\"RANK6-10\") as \"RANK6-10\",\n                max(agg.\"PAGE2\") as \"PAGE2\",\n                SUM(DISTINCT agg.search_volume) AS Search_Volume,\n                SUM(DISTINCT agg.traffic) AS Traffic,\n                agg.month_yr AS Month_yr,\n                agg.YYYYMMDD,\n                theme.parent_category,\n                theme.category,\n                theme.subcategory,\n                theme.theme,\n                device.pack_type,\n                flag.MARKETING_STAGE as  MARKETING_FUNNEL,\n                flag.KW_TYPE_LIST_FLAG ,\n                flag.KW_TYPE_QUESTION_FLAG ,\n                flag.KW_TYPE_LOCATION_FLAG ,\n                flag.KW_TYPE_COUNTRY_FLAG ,\n                flag.KW_TYPE_STATE_FLAG ,\n                flag.KW_TYPE_CITY_FLAG ,\n                flag.KW_TYPE_ENTITY_FLAG ,\n                flag.HEAD_TAIL ,\n\t\t\t\tcompany.BRAND_NONBRAND\n\t\t\tFROM \"BFSI_CI\".\"UAT\".\"AGG_BFSI_SOS_MONTHLY_TRAFFIC\" AS agg\n                  INNER JOIN \"BFSI_CI\".\"UAT\".\"DIM_BFSI_THEME_KW_LEVEL\" AS theme ON (agg.keyword=theme.keyword AND agg.locale=theme.locale)\n                  LEFT JOIN \"BFSI_CI\".\"UAT\".\"DIM_BFSI_KE_DOMAIN_SUB_MAP\" AS domain ON (domain.keyword=agg.keyword and domain.domain=agg.domain and domain.locale=agg.locale)\n                  LEFT JOIN \"BFSI_CI\".\"UAT\".\"DIM_BFSI_SERP_PACK_DATA\"  AS device on (device.keyword=agg.keyword and device.DEVICE =agg.DeviceType and device.locale=agg.locale)\n                  LEFT JOIN \"BFSI_CI\".\"UAT\".\"DIM_BFSI_INTENT_STAGE_CFN_KW_LEVEL\"  AS flag\n\t\t\t\t  ON(agg.keyword=flag.keyword)\n                   LEFT JOIN \"BFSI_CI\".\"UAT\".\"DIM_BFSI_COMPANY_KW_LEVEL\" AS company\n\t\t\t\t   on(agg.keyword=company.keyword)\n          \n          \n\t\t\tGROUP BY\n\t\t\tagg.keyword,\n            theme.universe,\n            agg.Locale,\n            agg.Search_Engine,\n            agg.DeviceType,\n            agg.month_yr,\n            agg.YYYYMMDD,\n            domain.Domain_Type,\n            agg.Domain,\n            domain.KW_LOCALE_DOMAIN_KEY,\n            theme.parent_category,\n                theme.category,\n                theme.subcategory,\n                theme.theme,\n            device.KW_LOCALE_DEVICE_KEY,\n            domain.domain,\n            DOMAIN.SUB_DOMAIN,\n            DEVICE.PACK_TYPE,\n            FLAG.MARKETING_STAGE,\n            flag.KW_TYPE_LIST_FLAG ,\n                flag.KW_TYPE_QUESTION_FLAG ,\n                flag.KW_TYPE_LOCATION_FLAG ,\n                flag.KW_TYPE_COUNTRY_FLAG ,\n                flag.KW_TYPE_STATE_FLAG ,\n                flag.KW_TYPE_CITY_FLAG ,\n                flag.KW_TYPE_ENTITY_FLAG ,\n                flag.HEAD_TAIL ,\n\t\t\t\tcompany.BRAND_NONBRAND\n        \n\t)\n  WHERE Domain_Type <> 'Other'"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"434520":{"id":434520,"sourceID":434525,"targetID":434523},"434534":{"id":434534,"sourceID":434527,"targetID":434523},"434557":{"id":434557,"sourceID":434523,"targetID":434556}},"canUndo":true,"undoCommand":"Set Parameter","undoCreated":1599464798545,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"HIERARCHY","description":null,"type":"TRANSFORMATION"}}