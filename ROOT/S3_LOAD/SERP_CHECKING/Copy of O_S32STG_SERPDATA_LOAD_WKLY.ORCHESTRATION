{"job":{"components":{"383336":{"id":383336,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":544,"y":-144,"width":32,"height":32,"inputConnectorIDs":[383347],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"383337":{"id":383337,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-64,"y":-144,"width":32,"height":32,"inputConnectorIDs":[383362,383363,383373,383374,383375,383496],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[383360],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ERROR_HANDLING"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"383338":{"id":383338,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-336,"y":16,"width":32,"height":32,"inputConnectorIDs":[383367],"outputSuccessConnectorIDs":[383430],"outputFailureConnectorIDs":[383374],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AUDIT_TABLE__UPDATE_INPROGRESS"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert into \"${DB}\".\"${STAGE_SCHEMA}\".st_audit \n(status,start_time,job_name,s3_path,file_name)\nvalues('In progress',current_timestamp,'SERPDATA LOAD','${S3_PATH}SERPDATA','${SERPDATA}')"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"383339":{"id":383339,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":544,"y":16,"width":32,"height":32,"inputConnectorIDs":[383344],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"383340":{"id":383340,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-576,"y":16,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[383361],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"START"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"383342":{"id":383342,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-30576616,"x":176,"y":16,"width":32,"height":32,"inputConnectorIDs":[383365],"outputSuccessConnectorIDs":[383366],"outputFailureConnectorIDs":[383375],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ARCHIVE_MOVE"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"aws s3 mv '${S3_PATH}'SERPDATA/'${SERPDATA}' '${S3_PATH}'SERPDATA/ARCHIVE/`date \"+%Y%m%d\"`/'${SERPDATA}'\n\n\n\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"383343":{"id":383343,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-480,"y":16,"width":32,"height":32,"inputConnectorIDs":[383361],"outputSuccessConnectorIDs":[383367],"outputFailureConnectorIDs":[383363],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TRN_STAGE_TBL"}}}},"visible":true},"3":{"slot":3,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DB}"}}}},"visible":true},"4":{"slot":4,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${STAGE_SCHEMA}"}}}},"visible":true},"5":{"slot":5,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ST_BFSI_SERP"}}}},"visible":true},"6":{"slot":6,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DW_PRODUCTS}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"383348":{"id":383348,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":368,"y":16,"width":32,"height":32,"inputConnectorIDs":[383366],"outputSuccessConnectorIDs":[383344],"outputFailureConnectorIDs":[383362],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AUDIT_TABLE_SUCCESS_STATUS"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"update \"${DB}\".\"${STAGE_SCHEMA}\".st_audit \nset status = 'Completed'\n,end_time = current_timestamp \n,file_count=(select cnt from (\nSELECT COUNT(\"created_date\")cnt from \"${DB}\".\"${DWH_SCHEMA}\".\"LKP_BFSI_SERP_DAILY\" where \"file_name\"='${SERPDATA}'\n))\n,duplicate_count=(select case when sum(cnt) is null then 0 else sum(cnt) end as cnt from (\nselect  \"keyword\" ,count(\"keyword\")cnt FROM \"${DB}\".\"${DWH_SCHEMA}\".\"LKP_BFSI_SERP_DAILY\" where \"file_name\"='${SERPDATA}'\n group by \"as_on_date\",\"keyword\",\"locale\",\"device_type\",\"organic_rank\",\"url\",\"domain\",\"ctr_pct_branded\",\"ctr_pct_nonbranded\"\n  HAVING COUNT(\"keyword\") >1\n\n))\n--where audit_id = (select max(audit_id) from \"${DB}\".\"${STAGE_SCHEMA}\".st_audit where job_name='SERPDATA LOAD')"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"383349":{"id":383349,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":368,"y":-144,"width":32,"height":32,"inputConnectorIDs":[383360],"outputSuccessConnectorIDs":[383347],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AUDIT_TABLE_FAIL_STATUS"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"update \"${DB}\".\"${STAGE_SCHEMA}\".st_audit\nset status = 'Failed'\n,end_time = current_timestamp \n,file_count=(select cnt from (\nSELECT COUNT(\"created_date\")cnt from \"${DB}\".\"${DWH_SCHEMA}\".\"LKP_BFSI_SERP_DAILY\" where \"file_name\"='${SERPDATA}'\n))\n,duplicate_count=(select case when sum(cnt) is null then 0 else sum(cnt) end as cnt from (\nselect  \"keyword\" ,count(\"keyword\")cnt FROM \"${DB}\".\"${DWH_SCHEMA}\".\"LKP_BFSI_SERP_DAILY\" where \"file_name\"='${SERPDATA}'\n group by \"as_on_date\",\"keyword\",\"locale\",\"device_type\",\"organic_rank\",\"url\",\"domain\",\"ctr_pct_branded\",\"ctr_pct_nonbranded\"\n  HAVING COUNT(\"keyword\") >1\n\n))\n--where audit_id = (select max(audit_id) from \"${DB}\".\"${STAGE_SCHEMA}\".st_audit where job_name='SERPDATA LOAD')"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"383350":{"id":383350,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":16,"y":16,"width":32,"height":32,"inputConnectorIDs":[383426],"outputSuccessConnectorIDs":[383365],"outputFailureConnectorIDs":[383373],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TR_SERP_DATA_DWH_LOAD"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of TR_STG2LKP_SERPDATA_LOAD_WKLY"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"383422":{"id":383422,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-160,"y":16,"width":32,"height":32,"inputConnectorIDs":[383430],"outputSuccessConnectorIDs":[383426],"outputFailureConnectorIDs":[383496],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"S3_TO_STAGE"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"COPY INTO \"${DB}\".\"${STAGE_SCHEMA}\".\"ST_BFSI_SERP\"(\"as_on_date\",\"keyword\",\"locale\",\n      \"device_type\",\"organic_rank\",\"url\",\n   \"domain\",\"ctr_pct_branded\",\"ctr_pct_non_branded\"\n)\nFROM\n(\nSELECT  SUBSTRING(replace(right('${SERPDATA}',12),'.csv',''),1,4)\n ||'-'||SUBSTRING(replace(right('${SERPDATA}',12),'.csv',''),5,2)\n ||'-'||SUBSTRING(replace(right('${SERPDATA}',12),'.csv',''),7,2),$2,$3,$4,$5,$6,$7,$8,$9\nFROM '@DM_INTERNAL.RESEARCH.MATILLION_STAGE_/ALPS/BFSI/DEV/SERPDATA/${SERPDATA}'\n)\nFILE_FORMAT = (TYPE = 'csv' FIELD_DELIMITER = ';' SKIP_HEADER = 1  )\nPURGE=FALSE ON_ERROR = CONTINUE FORCE=FALSE;"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"383344":{"id":383344,"sourceID":383348,"targetID":383339},"383347":{"id":383347,"sourceID":383349,"targetID":383336},"383365":{"id":383365,"sourceID":383350,"targetID":383342},"383366":{"id":383366,"sourceID":383342,"targetID":383348},"383367":{"id":383367,"sourceID":383343,"targetID":383338},"383426":{"id":383426,"sourceID":383422,"targetID":383350},"383430":{"id":383430,"sourceID":383338,"targetID":383422}},"failureConnectors":{"383362":{"id":383362,"sourceID":383348,"targetID":383337},"383363":{"id":383363,"sourceID":383343,"targetID":383337},"383373":{"id":383373,"sourceID":383350,"targetID":383337},"383374":{"id":383374,"sourceID":383338,"targetID":383337},"383375":{"id":383375,"sourceID":383342,"targetID":383337},"383496":{"id":383496,"sourceID":383422,"targetID":383337}},"unconditionalConnectors":{"383360":{"id":383360,"sourceID":383337,"targetID":383349},"383361":{"id":383361,"sourceID":383340,"targetID":383343}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":true,"undoCommand":"Set Parameter","undoCreated":1597320803555,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{},"variables":{},"grids":{}},"info":{"name":"Copy of O_S32STG_SERPDATA_LOAD_WKLY","description":"","type":"ORCHESTRATION"}}