{"job":{"components":{"437420":{"id":437420,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":272,"y":112,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[437429],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"OVERVIEW_INCREMENTAL_SCRIPT"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"WITH TOPHNDRD AS\n\t(\n\t\tSELECT\n\t\t\tkeyword,\n\t\t\tProduct,\n\t\t\tLocale,\n\t\t\tSearch_Engine,\n\t\t\tDOMAIN,\n\t\t\tDomain_Type,\n\t\t\tDeviceType,\n\t\t\tSearch_Volume,\n\t\t\tTraffic,\n\t\t\tMonth_yr,\n\t\t\tYYYYMMDD,\n\t\t\tKW_LOCALE_DOMAIN_KEY,\n            KW_LOCALE_PRODUCT_KEY,\n            KW_LOCALE_DEVICE_KEY,\n            \"RANK1-5\" as \"RANK1-5\",\n            case when \"RANK1-5\" = 1 then 0 \n            else \"RANK6-10\" end as \"RANK6-10\",\n            case when \"RANK1-5\"= 1 then 0\n                 when \"RANK6-10\" = 1 then 0\n            else \"PAGE2\" end as \"PAGE2\",\n\t\t\tROW_NUMBER() over (PARTITION BY Product,locale,Month_yr,Domain_Type order by traffic DESC) AS RowNo\n\t\tFROM\n\t\t(\n\t\t\tSELECT\n\t\t\t\tagg.keyword as keyword,\n                theme.universe AS Product,\n                agg.locale AS Locale,\n                agg.search_engine AS Search_Engine,\n                agg.DOMAIN as DOMAIN,\n                CASE\n                    WHEN domain.domain_type IS NULL THEN 'Other'\n                    ELSE domain.domain_type\n                END AS Domain_Type,\n                agg.DeviceType,\n                max(agg.\"RANK1-5\") as \"RANK1-5\",\n                max(agg.\"RANK6-10\") as \"RANK6-10\",\n                max(agg.\"PAGE2\") as \"PAGE2\",\n                SUM(DISTINCT agg.search_volume) AS Search_Volume,\n                SUM(DISTINCT agg.traffic) AS Traffic,\n                agg.month_yr AS Month_yr,\n                agg.YYYYMMDD,\n                domain.KW_LOCALE_DOMAIN_KEY,\n                theme.KW_LOCALE_PRODUCT_KEY,\n                device.KW_LOCALE_DEVICE_KEY\n\t\t\tFROM \"BFSI_CI\".\"UAT\".\"AGG_BFSI_SOS_MONTHLY_TRAFFIC\" AS agg\n                  inner JOIN \"BFS_DEV\".\"DWH\".\"DIM_BFSI_THEME_KW_LEVEL\" AS theme ON (agg.keyword=theme.keyword AND agg.locale=theme.locale)\n                  LEFT JOIN \"BFS_DEV\".\"DWH\".\"DIM_BFSI_KE_DOMAIN_SUB_MAP\" AS domain ON (domain.keyword=agg.keyword and domain.domain=agg.domain and domain.locale=agg.locale)\n                  LEFT JOIN \"BFS_DEV\".\"DWH\".\"DIM_BFSI_SERP_PACK_DATA\"  AS device on (device.keyword=agg.keyword and device.DEVICE =agg.DeviceType and device.locale=agg.locale)\n\t\t\tGROUP BY\n\t\t\tagg.keyword,\n            theme.universe,\n            agg.Locale,\n            agg.Search_Engine,\n            agg.DeviceType,\n            agg.month_yr,\n            agg.YYYYMMDD,\n            domain.Domain_Type,\n            agg.Domain,\n            domain.KW_LOCALE_DOMAIN_KEY,\n            theme.KW_LOCALE_PRODUCT_KEY,\n            device.KW_LOCALE_DEVICE_KEY\n\t\t\t--ORDER BY search_volume desc\n\t\t)\n\t\tWHERE TRAFFIC IS NOT NULL AND   Domain_Type = 'Other'\n\t)\n\tSELECT\n\t\tkeyword,\n\t\tProduct,\n\t\tLocale,\n\t\tSearch_Engine,\n\t\tDOMAIN,\n\t\tDomain_Type,\n\t\tDeviceType,\n\t\tSearch_Volume,\n\t\tTraffic,\n\t\tMonth_yr,\n\t\tYYYYMMDD,\n\t\tKW_LOCALE_DOMAIN_KEY,\n\t\tKW_LOCALE_PRODUCT_KEY,\n\t\tKW_LOCALE_DEVICE_KEY,\n        \"RANK1-5\" as RANK_1_5,\n        \"RANK6-10\" as RANK_6_10,\n         \"PAGE2\" as PAGE2\n\tFROM TOPHNDRD WHERE RowNo <= 100\n\n\tUNION ALL\n\t\n    SELECT\n\t\tkeyword,\n\t\tProduct,\n\t\tLocale,\n\t\tSearch_Engine,\n\t\tDOMAIN,\n\t\tDomain_Type,\n\t\tDeviceType,\n\t\tSearch_Volume,\n\t\tTraffic,\n\t\tMonth_yr,\n\t\tYYYYMMDD,\n\t\tKW_LOCALE_DOMAIN_KEY,\n\t\tKW_LOCALE_PRODUCT_KEY,\n\t\tKW_LOCALE_DEVICE_KEY,\n        \"RANK1-5\" as RANK_1_5,\n        case when \"RANK1-5\" = 1 then 0 \n        else \"RANK6-10\" end as RANK_6_10,\n        case when \"RANK1-5\"= 1 then 0\n             when \"RANK6-10\" = 1 then 0\n        else \"PAGE2\" end as PAGE2\n\tFROM\n\t(\n\t\tSELECT\n\t\t\tagg.keyword as keyword,\n\t\t\ttheme.universe AS Product,\n\t\t\tagg.locale AS Locale,\n\t\t\tagg.search_engine AS Search_Engine,\n\t\t\tagg.DOMAIN as DOMAIN,\n\t\t\tCASE\n\t\t\t    WHEN domain.domain_type IS NULL THEN 'Other'\n\t\t\t    ELSE domain.domain_type\n\t\t\tEND AS Domain_Type,\n\t\t\tagg.DeviceType,\n            MAX(agg.\"RANK1-5\") as \"RANK1-5\",\n            MAX(agg.\"RANK6-10\") as \"RANK6-10\",\n            MAX(agg.\"PAGE2\") as \"PAGE2\",\n\t\t\tSUM(DISTINCT agg.search_volume) AS Search_Volume,\n\t\t\tSUM(DISTINCT agg.traffic) AS Traffic,\n\t\t\tagg.month_yr AS Month_yr,\n\t\t\tagg.YYYYMMDD,\n            domain.KW_LOCALE_DOMAIN_KEY,\n            theme.KW_LOCALE_PRODUCT_KEY,\n            device.KW_LOCALE_DEVICE_KEY\n\t\t\t--agg.KEYWORD||'|'||agg.Domain||'|'||agg.LOCALE AS KW_DOMAIN_KEY,\n\t\t\t--agg.KEYWORD||'|'||theme.universe||'|'||agg.LOCALE AS KW_LOCALE_PRODUCT_KEY,\n\t\t\t--agg.KEYWORD||'|'||agg.LOCALE||'|'||INITCAP(agg.DeviceType) AS KW_LOCALE_DEVICE_KEY\n\t\tFROM \"BFSI_CI\".\"UAT\".\"AGG_BFSI_SOS_MONTHLY_TRAFFIC\" AS agg\n\t\tinner JOIN \"BFS_DEV\".\"DWH\".\"DIM_BFSI_THEME_KW_LEVEL\" AS theme ON (agg.keyword=theme.keyword AND agg.locale=theme.locale)\n        LEFT JOIN \"BFS_DEV\".\"DWH\".\"DIM_BFSI_KE_DOMAIN_SUB_MAP\" AS domain ON (domain.keyword=agg.keyword and domain.domain=agg.domain and domain.locale=agg.locale)\n        LEFT JOIN \"BFS_DEV\".\"DWH\".\"DIM_BFSI_SERP_PACK_DATA\"  AS device on (device.keyword=agg.keyword and device.DEVICE =agg.DeviceType and device.locale=agg.locale)\n      \n\t\tGROUP BY\n\t\tagg.keyword,\n\t\ttheme.universe,\n\t\tagg.Locale,\n\t\tagg.Search_Engine,\n\t\tagg.DeviceType,\n\t\tagg.month_yr,\n\t\tagg.YYYYMMDD,\n\t\tdomain.Domain_Type,\n\t\tagg.Domain,\n        domain.KW_LOCALE_DOMAIN_KEY,\n        theme.KW_LOCALE_PRODUCT_KEY,\n        device.KW_LOCALE_DEVICE_KEY\n        \n\t)\n  WHERE Domain_Type <> 'Other'"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"437428":{"id":437428,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":560,"y":112,"width":32,"height":32,"inputConnectorIDs":[437429],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AGG_BFSI_SOV_OVERVIEW_INCREMENTAL"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AGG_BFSI_SOV_OVERVIEW_INCREMENTAL"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"KEYWORD"},"2":{"slot":2,"type":"STRING","value":"KEYWORD"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"PRODUCT"},"2":{"slot":2,"type":"STRING","value":"PRODUCT"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"LOCALE"},"2":{"slot":2,"type":"STRING","value":"LOCALE"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"SEARCH_ENGINE"},"2":{"slot":2,"type":"STRING","value":"SEARCH_ENGINE"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"DOMAIN"},"2":{"slot":2,"type":"STRING","value":"DOMAIN"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"DOMAIN_TYPE"},"2":{"slot":2,"type":"STRING","value":"DOMAIN_TYPE"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"DEVICETYPE"},"2":{"slot":2,"type":"STRING","value":"DEVICETYPE"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"SEARCH_VOLUME"},"2":{"slot":2,"type":"STRING","value":"SEARCH_VOLUME"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"TRAFFIC"},"2":{"slot":2,"type":"STRING","value":"TRAFFIC"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"MONTH_YR"},"2":{"slot":2,"type":"STRING","value":"MONTH_YR"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"YYYYMMDD"},"2":{"slot":2,"type":"STRING","value":"YYYYMMDD"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"KW_LOCALE_DOMAIN_KEY"},"2":{"slot":2,"type":"STRING","value":"KW_LOCALE_DOMAIN_KEY"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"KW_LOCALE_PRODUCT_KEY"},"2":{"slot":2,"type":"STRING","value":"KW_LOCALE_PRODUCT_KEY"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"KW_LOCALE_DEVICE_KEY"},"2":{"slot":2,"type":"STRING","value":"KW_LOCALE_DEVICE_KEY"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"RANK_1_5"},"2":{"slot":2,"type":"STRING","value":"RANK_1_5"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"RANK_6_10"},"2":{"slot":2,"type":"STRING","value":"RANK_6_10"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"PAGE2"},"2":{"slot":2,"type":"STRING","value":"PAGE2"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate"}}}},"visible":true},"200":{"slot":200,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DWH_SCHEMA}"}}}},"visible":true},"201":{"slot":201,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DB}"}}}},"visible":true},"202":{"slot":202,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${WAREHOUSE}"}}}},"visible":true},"203":{"slot":203,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"437429":{"id":437429,"sourceID":437420,"targetID":437428}},"canUndo":true,"undoCommand":"Set Parameter","undoCreated":1598959932531,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"TR_AGG_BFSI_SOV_OVERVIEW_INCREMENTAL_LOAD","description":null,"type":"TRANSFORMATION"}}